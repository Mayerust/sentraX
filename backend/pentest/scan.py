import nmap
from utils.gpt_client import ask_gpt

def do_scan(target_ip, recon_info, logger):
    nm = nmap.PortScanner()
    nm.scan(target_ip, arguments='-sV -O')
    scan_data = nm[target_ip]
    logger.info(f"Nmap scan for {target_ip}: {scan_data}")
    prompt = f"Nmap output: {scan_data}"
    scan_analysis = ask_gpt(prompt)
    return {"raw": scan_data, "analysis": scan_analysis}